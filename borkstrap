#!/usr/bin/env ruby

# === borkstrap ===
# === borkstrap ===end
# === borkstrap ===end
# === borkstrap ===end
# === borkstrap ===end
# === borkstrap ===end
# https://github.com/alfiepates/borkstrap

require 'optparse'
require 'pathname'
require 'net/http'

module Borkstrap
	class OptionParser
		def initialize(arguments)
			@arguments = arguments
		end

		def call
			options = {}
			::OptionParser.new do |option_parser|
				option_parser.banner = "Usage: ./borkstrap [options]" 

				option_parser.on("-r", "--repo repository", String,
					"Pull a Git repository with a Bork configuration") do |repository|

					options[:repo] = 
						if github_shortname?(repository)
							"https://github.com/#{repository}"
						else
							repository
						end
				end
			end.parse!(@arguments)
			options
		end

		private

		def github_shortname?(url)
			url.scan("/").length == 1
		end
	end

	class Host
		def self.current
			new(mac: RUBY_PLATFORM =~ /darwin/)
		end

		def initialize(mac: raise(ArgumentError, "missing keyword :mac"))
			@mac = mac
		end

		def mac?
			@mac 
		end
	end

	class BrewInstall
		def initialize(install_script_url: raise(ArgumentError, "missing keyword :install_script_url"))
    		@install_script_uri = URI(install_script_url)
		end

		def install_script
			install_script_path = File.expand_path('~/.cache/brew-install')
    		File.write install_script_path, Net::HTTP.get(@install_script_uri)
    		Pathname.new install_script_path
		end
	end
end

if __FILE__ == $0
	Borkstrap::OptionParser.new(ARGV).call
end
